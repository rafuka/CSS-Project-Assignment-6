"use strict";var shopData={},cartData={},totalCartItems=0,totalPriceNum=0,shopTemplateHTML=$("#shop-template").html(),shopTemplate=Handlebars.compile(shopTemplateHTML),cartTemplateHTML=$("#cart-template").html(),cartTemplate=Handlebars.compile(cartTemplateHTML),detailsTemplateHTML=$("#item-details-template").html(),detailsTemplate=Handlebars.compile(detailsTemplateHTML),$body=$("body"),$totalPriceElem=$("#total-price"),$shop=$("#shop"),$shopList=$("#shop-list"),$cart=$("#cart"),$cartList=$("#cart-list"),$cartOverlay=$("#cart-overlay"),$cartNumElm=$("#cart-num"),$cartIcon=$("#cart-icon"),$loadingModal=$("#loading-modal"),$loader=$("#loader"),$detailsModal=$("#item-details-modal"),$detailsOverlay=$("#details-overlay"),$applyCouponBtn=$(".cart-footer__coupon-apply"),$couponInput=$("#coupon");function toggleCart(){$cart.hasClass("visible")?TweenMax.isTweening($cart)||($body.removeClass("no-scroll"),$cart.removeClass("visible"),$cartOverlay.removeClass("cart-toggle"),TweenMax.to($cart,.7,{right:"-650px",ease:Back.easeIn.config(1.2)}),TweenMax.to($cartOverlay,.8,{display:"none",opacity:0})):TweenMax.isTweening($cart)||(TweenMax.to($cart,.7,{right:"-50px",ease:Back.easeOut.config(1.2)}),$cart.addClass("visible"),$cartOverlay.addClass("cart-toggle"),TweenMax.to($cartOverlay,.8,{display:"block",opacity:.8,autoAlpha:1}),$body.addClass("no-scroll"))}function toggleDetails(a){if($(a.target).hasClass("shop-item__details")){var t=getItemIdNum($(a.target).closest(".shop-item")),e=!0,l=!1,r=void 0;try{for(var o,i=shopData.items[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;if(s.id==t){var c=detailsTemplate(s);$detailsModal.html(c);break}}}catch(a){l=!0,r=a}finally{try{!e&&i.return&&i.return()}finally{if(l)throw r}}}var n=new TimelineMax;if($detailsModal.hasClass("visible"))TweenMax.isTweening($detailsModal)||TweenMax.isTweening($detailsOverlay)||($body.removeClass("no-scroll"),$detailsOverlay.removeClass("details-toggle"),$detailsModal.removeClass("visible"),$detailsModal.find(".carousel").unbind("click",handleNextImage),n.to($detailsModal,.3,{display:"none",y:"+=75px",autoAlpha:0}).to($detailsOverlay,.3,{display:"none",autoAlpha:0}));else if(!TweenMax.isTweening($detailsModal)&&!TweenMax.isTweening($detailsOverlay)){$body.addClass("no-scroll"),$detailsOverlay.addClass("details-toggle"),$detailsModal.addClass("visible");var d=$detailsModal.find(".carousel__image");d.first().addClass("visible"),TweenMax.to(d.first(),0,{display:"block",autoAlpha:1});var m=d.toArray(),p=new TimelineMax,u=$detailsModal.find(".carousel"),y={imgArr:m,animation:p,$carousel:u};u.bind("click",y,handleNextImage),n.to($detailsOverlay,.3,{display:"block",autoAlpha:.8}).to($detailsModal,.5,{display:"block",y:"-=75px",autoAlpha:1})}}function addItem(a){TweenMax.isTweening($cartIcon)||TweenMax.from($cartIcon,.7,{scale:1.5,ease:Bounce.easeOut});var t=$(a.target).closest(".shop-item").attr("id"),e=parseInt(t.replace(/[^0-9]/gi,"")),l=!1,r=!0,o=!1,i=void 0;try{for(var s,c=cartData.items[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var n=s.value;if(n.id==e){n.qty++,l=!0;break}}}catch(a){o=!0,i=a}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}if(!l){var d=!0,m=!1,p=void 0;try{for(var u,y=shopData.items[Symbol.iterator]();!(d=(u=y.next()).done);d=!0){var v=u.value;if(v.id==e){v.qty=1,cartData.items.unshift(v);break}}}catch(a){m=!0,p=a}finally{try{!d&&y.return&&y.return()}finally{if(m)throw p}}}updateCartList()}function decreaseQty(a){var t=getItemIdNum($(a.target).closest(".cart-item")),e=!0,l=!1,r=void 0;try{for(var o,i=cartData.items[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;if(s.id==t){if(1<s.qty)s.qty--,updateCartList();else if(confirm("Do you want to remove "+s.title+" from the cart?")){var c=cartData.items.indexOf(s);cartData.items.splice(c,1),updateCartList()}break}}}catch(a){l=!0,r=a}finally{try{!e&&i.return&&i.return()}finally{if(l)throw r}}}function increaseQty(a){var t=getItemIdNum($(a.target).closest(".cart-item")),e=!0,l=!1,r=void 0;try{for(var o,i=cartData.items[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;if(s.id==t){s.qty++,updateCartList();break}}}catch(a){l=!0,r=a}finally{try{!e&&i.return&&i.return()}finally{if(l)throw r}}}function removeItem(a){var t=getItemIdNum($(a.target).closest(".cart-item")),e=!0,l=!1,r=void 0;try{for(var o,i=cartData.items[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var s=o.value;if(s.id==t){if(confirm("Do you want to remove "+s.title+" from the cart?")){var c=cartData.items.indexOf(s);cartData.items.splice(c,1),updateCartList()}break}}}catch(a){l=!0,r=a}finally{try{!e&&i.return&&i.return()}finally{if(l)throw r}}}function updateCartList(){for(var a=totalCartItems=totalPriceNum=0,t=cartData.items.length;a<t;a++){var e=cartData.items[a];totalPriceNum+=e.price*e.qty,totalCartItems+=e.qty}if($cartNumElm.text(totalCartItems),cartData.coupon){switch(cartData.coupon){case"DEADBEEF":totalPriceNum-=.15*totalPriceNum;break;case"BLAHBLAH":totalPriceNum-=10}totalPriceNum<0&&(totalPriceNum=0),$(".cart-footer__price").addClass("with-coupon")}$totalPriceElem.text(totalPriceNum.toFixed(2));var l=cartTemplate(cartData);$cartList.html(l),localStorage.setItem("cartData",JSON.stringify(cartData))}function getItemIdNum(a){var t=a.attr("id");return parseInt(t.replace(/[^0-9]/gi,""))}function handleNextImage(a){for(var t=a.data.imgArr,e=a.data.animation,l=(a.data.$carousel,0),r=0,o=0,i=0;i<t.length;i++)$(t[i]).hasClass("visible")&&(r=(l=i)+1>=t.length?0:i+1,o=i-1<0?t.length-1:i-1);$(a.target).hasClass("carousel__control-right")?displayNextImage(t,e,l,r):$(a.target).hasClass("carousel__control-left")&&displayNextImage(t,e,l,o)}function displayNextImage(a,t,e,l){t.to($(a[e]),.3,{display:"none",autoAlpha:0}).to($(a[l]),.3,{display:"block",autoAlpha:1}),$(a[e]).removeClass("visible"),$(a[l]).addClass("visible")}function handleCoupon(a){switch($couponInput.val()){case"DEADBEEF":cartData.coupon="DEADBEEF",updateCartList();break;case"BLAHBLAH":cartData.coupon="BLAHBLAH",updateCartList()}}localStorage.getItem("cartData")?(cartData=JSON.parse(localStorage.getItem("cartData")),updateCartList()):cartData={items:[]},$.getJSON("shopdata.json",function(a){var t=shopTemplate(shopData=a);$shopList.html(t),setInterval(function(){$loader.addClass("success"),$shop.removeClass("hidden"),(new TimelineMax).to($loader,.4,{border:"0px",backgroundColor:"black",animation:"none",rotate:0}).to($loader,.7,{height:"0px",width:"0px",display:"none",top:"50%",left:"50%",ease:Back.easeIn.config(5)}).to($loadingModal,.3,{opacity:0,display:"none"}).to($shop,.3,{display:"block",autoAlpha:1})},800),$body.on("click",".cart-toggle",toggleCart),$body.on("click",".details-toggle",toggleDetails),$shopList.on("click",".shop-item__add-btn",addItem),$cart.on("click",".cart-item__less",decreaseQty),$cart.on("click",".cart-item__plus",increaseQty),$cart.on("click",".cart-item__remove",removeItem),$applyCouponBtn.on("click",handleCoupon)});